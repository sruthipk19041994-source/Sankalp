{% extends 'base.html' %}
{% block title %}Education Support Requests{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="text-center mb-4">
    <h3 class="fw-bold text-primary">üìö Education Support Requests (Forwarded by Volunteers)</h3>
    <p class="text-muted">View and respond to requests submitted for students in need</p>
    <hr class="w-25 mx-auto">
  </div>

  <!-- ‚úÖ Approved -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white fw-bold">‚úÖ Approved Requests</div>
    <div class="card-body">
      {% if approved_requests %}
        <table class="table table-hover table-bordered align-middle">
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Education Level</th>
              <th>Volunteer</th>
              <th>Approved On</th>
            </tr>
          </thead>
          <tbody>
            {% for req in approved_requests %}
            <tr>
              <td>{{ req.full_name }}</td>
              <td>{{ req.education_level }}</td>
              <td>
                {% if req.volunteer %}
  {{ req.volunteer.get_full_name|default:req.volunteer.username }}
{% else %}
  Not assigned
{% endif %}

              </td>
              <td>{{ req.decision_at|date:"d M Y, h:i A"|default:"‚Äî" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted">No approved requests yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- ‚ùå Rejected -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-danger text-white fw-bold">‚ùå Rejected Requests</div>
    <div class="card-body">
      {% if rejected_requests %}
        <ul class="list-group">
          {% for req in rejected_requests %}
            <li class="list-group-item">
              <strong>{{ req.full_name }}</strong> ‚Äì {{ req.reason|truncatewords:8 }}
              <br><small class="text-muted">
                Forwarded by 
                {{ req.volunteer.user.get_full_name|default:req.volunteer.user.username|default:"Unknown" }}
              </small>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No rejected requests.</p>
      {% endif %}
    </div>
  </div>

  <!-- üì® Forwarded -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-info text-white fw-bold">üì® Forwarded Requests</div>
    <div class="card-body">
      {% if forwarded_requests %}
        <table class="table table-hover table-bordered align-middle">
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Education Level</th>
              <th>Volunteer</th>
              <th>Forwarded On</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for req in forwarded_requests %}
            <tr>
              <td>{{ req.full_name }}</td>
              <td>{{ req.education_level }}</td>
              <td>
                {% if req.volunteer and req.volunteer.user %}
                  {{ req.volunteer.user.get_full_name|default:req.volunteer.user.username }}
                {% else %}
                  Not assigned
                {% endif %}
              </td>
              <td>{{ req.forwarded_at|date:"d M Y, h:i A"|default:"‚Äî" }}</td>
              <td>
                <form method="post" action="{% url 'approve_student_request' req.id %}" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-success btn-sm">Approve</button>
                </form>
                <form method="post" action="{% url 'reject_student_request' req.id %}" class="d-inline ms-2">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted">No forwarded requests yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
